{
  "name": "Civilization II: Test of Time (TOTPP v0.18.4)",
  "game_slug": "test-of-time-totpp-18-4",
  "version": "Install Test of Time With Test of Time Patch Project v0.18.4",
  "slug": "test-of-time-installer",
  "runner": "wine",
  "script": {
    "game": {
      "exe": "$GAMEDIR/drive_c/Test of Time/TOTLauncher.exe",
      "prefix": "$GAMEDIR",
      "working_dir": "$GAMEDIR/drive_c/Test of Time",
      "arch": "win32"
    },
    "files": [
      {
        "tot-v-1-1": {
          "url": "https://forums.civfanatics.com/resources/test-of-time-v1-1-patch.59/download",
          "filename": "Official Version 1.1 Patch",
          "referrer": "forums.civfanatics.com"
        }
      },
      {
        "totpp": {
          "url": "https://forums.civfanatics.com/attachments/totppv018-4-zip.619222/",
          "filename": "Test of Time Patch Project v0.18.4",
          "referrer": "forums.civfanatics.com"
        }
      },
      {
        "music": {
          "url": "https://github.com/ProfGarfield/ExtendedMusicForTOTPP/archive/refs/heads/main.zip",
          "filename": "Extended Music for TOTPP",
          "referrer": "github.com/ProfGarfield"
        }
      },
      {
        "midgard": {
          "url": "http://users.tpg.com.au/jpwbeest/files/Midgard_patch.7z",
          "filename": "Catfish's Midgard Patch",
          "referrer": "Catfish's Cave Website"
        }
      },
      {
        "paradox": {
          "url": "http://sleague.civfanatics.com/images/2/23/CIVIITTP.rar",
          "filename": "Official Time Threat Paradox Scenario",
          "referrer": "sleage.civfanatics.com"
        }
      }
    ],
    "installer": [
      {
        "insert-disc": {
          "requires": "Civ2/civ2.exe"
        }
      },
      {
        "task": {
          "app": "winxp",
          "arch": "win32",
          "name": "winetricks",
          "prefix": "$GAMEDIR"
        }
      },
      {
        "input_menu": {
          "description": "The Test of Time installer is about to run.  Install the game to the default suggested directory (C:\\Program Files\\Microprose\\Test of Time).  This script will automatically move the game files to a different directory at the appropriate time.",
          "options": [
            {
              "Yes": "I understand."
            }
          ]
        }
      },
      {
        "task": {
          "arch": "win32",
          "executable": "$DISC/SETUP.EXE",
          "name": "wineexec",
          "prefix": "$GAMEDIR",
          "working_dir": "$DISC"
        }
      },
      {
        "extract": {
          "dst": "$GAMEDIR/drive_c",
          "file": "paradox",
          "format": "rar"
        }
      },
      {
        "task": {
          "executable": "$GAMEDIR/drive_c/CIVIITTP.exe",
          "name": "wineexec"
        }
      },
      {
        "task": {
          "executable": "tot-v-1-1",
          "name": "wineexec"
        }
      },
      {
        "move": {
          "src": "$GAMEDIR/drive_c/Program Files/Microprose/Test of Time",
          "dst": "$GAMEDIR/drive_c/Test of Time"
        }
      },
      {
        "copy": {
          "src": "$DISC/Civ2/Video",
          "dst": "$GAMEDIR/drive_c/Test of Time/Video"
        }
      },
      {
        "execute": {
          "command": "chmod -R u+w \"$GAMEDIR/drive_c/Test of Time/Video\""
        }
      },
      {
        "extract": {
          "dst": "$GAMEDIR/drive_c/Test of Time",
          "file": "totpp",
          "format": "zip"
        }
      },
      {
        "extract": {
          "dst": "$GAMEDIR/drive_c/Test of Time/Midgard",
          "file": "midgard",
          "format": "7z"
        }
      },
      {
        "extract": {
          "dst": "$GAMEDIR/drive_c/Test of Time",
          "file": "music",
          "format": "zip"
        }
      },
      {
        "input_menu": {
          "description": "Extended Music for TOTPP allows you to play any .mp3 file in the Test of Time/Music directory, and write custom playlists.  It will require the Lua Scripting patch to be active while playing the game.",
          "id": "EXTRAMUSIC",
          "options": [
            {
              "AddToLuaFolder": "Yes, I would like the Extended Music for TOTPP features."
            },
            {
              "empty": "No.  I only care about listening to Test of Time's original music."
            }
          ]
        }
      },
      {
        "execute": {
          "command": "mkdir \"$GAMEDIR/drive_c/Test of Time/empty\""
        }
      },
      {
        "merge": {
          "src": "$GAMEDIR/drive_c/Test of Time/$INPUT_EXTRAMUSIC",
          "dst": "$GAMEDIR/drive_c/Test of Time/lua"
        }
      },
      {
        "merge": {
          "src": "$GAMEDIR/drive_c/Test of Time/ModifiedGameTxt",
          "dst": "$GAMEDIR/drive_c/Test of Time/AddToLuaFolder"
        }
      },
      {
        "execute": {
          "command": "rm -r \"$GAMEDIR/drive_c/Test of Time/ModifiedGameTxt\""
        }
      },
      {
        "execute": {
          "command": "mkdir \"$GAMEDIR/drive_c/Test of Time/empty/Original\""
        }
      },
      {
        "execute": {
          "command": "mkdir \"$GAMEDIR/drive_c/Test of Time/empty/Fantasy\""
        }
      },
      {
        "execute": {
          "command": "mkdir \"$GAMEDIR/drive_c/Test of Time/empty/ExtendedOriginal\""
        }
      },
      {
        "execute": {
          "command": "mkdir \"$GAMEDIR/drive_c/Test of Time/empty/Elsewhere in Time\""
        }
      },
      {
        "execute": {
          "command": "mkdir \"$GAMEDIR/drive_c/Test of Time/empty/Scifi\""
        }
      },
      {
        "merge": {
          "src": "$GAMEDIR/drive_c/Test of Time/$INPUT_EXTRAMUSIC/Original",
          "dst": "$GAMEDIR/drive_c/Test of Time/Original"
        }
      },
      {
        "merge": {
          "src": "$GAMEDIR/drive_c/Test of Time/$INPUT_EXTRAMUSIC/Fantasy",
          "dst": "$GAMEDIR/drive_c/Test of Time/Fantasy"
        }
      },
      {
        "merge": {
          "src": "$GAMEDIR/drive_c/Test of Time/$INPUT_EXTRAMUSIC/ExtendedOriginal",
          "dst": "$GAMEDIR/drive_c/Test of Time/ExtendedOriginal"
        }
      },
      {
        "merge": {
          "src": "$GAMEDIR/drive_c/Test of Time/$INPUT_EXTRAMUSIC/Elsewhere in Time",
          "dst": "$GAMEDIR/drive_c/Test of Time/Elsewhere in Time"
        }
      },
      {
        "merge": {
          "src": "$GAMEDIR/drive_c/Test of Time/$INPUT_EXTRAMUSIC/Scifi",
          "dst": "$GAMEDIR/drive_c/Test of Time/Scifi"
        }
      },
      {
        "execute": {
          "command": "rm -r \"$GAMEDIR/drive_c/Test of Time/empty\""
        }
      },
      {
        "execute": {
          "command": "rm -r \"$GAMEDIR/drive_c/Test of Time/AddToLuaFolder\""
        }
      },
      {
        "execute": {
          "command": "rm  \"$GAMEDIR/drive_c/Test of Time/README.md\""
        }
      },
      {
        "write_file": {
          "file": "$GAMEDIR/batch.bat",
          "content": "@ECHO OFF\n\nREM \"Modified code from https://stackoverflow.com/questions/25815928/use-a-batch-file-to-list-files-and-allow-the-user-to-select-which-file-to-pass-t\"\n\n@ECHO OFF\nSET index=1\nSETLOCAL ENABLEDELAYEDEXPANSION\ncd \"drive_c\\Test of Time\"\nFOR /R %%f IN (*.bat) DO (\n   SET file!index!=%%f\n   CALL :SHORTEN \"%%f\"\n   ECHO !index! - !fil!\n   SET /A index=!index!+1\n)\nSETLOCAL DISABLEDELAYEDEXPANSION\nSET /P selection=Choose the number for the batch file you wish to run:\nSET file%selection% >nul 2>&1\nCALL :RESOLVE %%file%selection%%%\nfor %%a in (\"%file_name%\") do cd %%~dpa\n\"%file_name%\"\nGOTO :EOF\n\n:RESOLVE\nSET file_name=%1\nGOTO :EOF\n\n:SHORTEN\nSET fil=%1\nSET \"fil=%fil:*drive_c=%\"\nSET \"fil=%fil:\\Test of Time\\=...%\"\nGOTO :EOF\n\nGOTO :EOF\n"
        }
      }
    ],
    "wine": {
      "arch": "win32",
      "dxvk": false
    }
  }
}
